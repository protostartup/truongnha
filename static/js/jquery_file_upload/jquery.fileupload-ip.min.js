(function(a){if(typeof define==="function"&&define.amd){define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],a)}else{a(window.jQuery,window.loadImage,window.canvasToBlob)}}(function(b,c,a){b.widget("blueimpIP.fileupload",b.blueimp.fileupload,{options:{resizeSourceFileTypes:/^image\/(gif|jpeg|png)$/,resizeSourceMaxFileSize:20000000,resizeMaxWidth:undefined,resizeMaxHeight:undefined,resizeMinWidth:undefined,resizeMinHeight:undefined,add:function(f,d){b(this).fileupload("resize",d).done(function(){d.submit()})}},_resizeImage:function(k,h,g){var j=this,i=k[h],e=b.Deferred(),f,d;g=g||this.options;c(i,function(m){var n=m.width,l=m.height;f=c.scale(m,{maxWidth:g.resizeMaxWidth,maxHeight:g.resizeMaxHeight,minWidth:g.resizeMinWidth,minHeight:g.resizeMinHeight,canvas:true});if(n!==f.width||l!==f.height){a(f,function(o){if(!o.name){if(i.type===o.type){o.name=i.name}else{if(i.name){o.name=i.name.replace(/\..+$/,"."+o.type.substr(6))}}}k[h]=o;e.resolveWith(j)},i)}else{e.resolveWith(j)}});return e.promise()},resize:function(h){var e=this,d=b.extend({},this.options,h),g=b.type(d.resizeSourceMaxFileSize)!=="number",f=this._isXHRUpload(d);b.each(h.files,function(i,j){if(f&&e._resizeSupport&&(d.resizeMaxWidth||d.resizeMaxHeight||d.resizeMinWidth||d.resizeMinHeight)&&(g||j.size<d.resizeSourceMaxFileSize)&&d.resizeSourceFileTypes.test(j.type)){e._processing+=1;if(e._processing===1){e.element.addClass("fileupload-processing")}e._processingQueue=e._processingQueue.pipe(function(){var k=b.Deferred();e._resizeImage(h.files,i,d).done(function(){e._processing-=1;if(e._processing===0){e.element.removeClass("fileupload-processing")}k.resolveWith(e)});return k.promise()})}});return this._processingQueue},_create:function(){b.blueimp.fileupload.prototype._create.call(this);this._processing=0;this._processingQueue=b.Deferred().resolveWith(this).promise();this._resizeSupport=a&&a(document.createElement("canvas"),b.noop)}})}));