{% extends "base.html" %}
{% load dictionary %}
{% block js %}
    <script type="text/javascript">
        $(document).ready(function(){
            $("#loaitin{{type}}").attr("checked", "true");
        });
    </script>
    <script type="text/javascript"
        src="/static/js/template_js/count_sms.js?{{ VERSION }}"></script>
{% endblock %}

{% block css %}
    <style type="text/css">
    label, input {
        padding-right: 1em;
        padding-left: 1em;
        vertical-align: middle;
    }
    </style>
{% endblock %}

{% block breadcrumb %}
    {{ block.super }}
    {% load breadcrumb_tags %}
    {% add_crumb 'Liên lạc' 'sms_summary' '' %}
    {% add_crumb 'Lịch sử nhắn tin' %}
{% endblock %}

{% block content %}
    <div class="btn-toolbar pagination-centered">
        <form class="form-inline" action="{% url count_sms %}" name="info"
              method="post"> {% csrf_token %}
            <fieldset>
                <label>Từ ngày</label>
                <input id="id_date1" name="firstDate"
                class="datepicker input-small"
                value="{{day}}/{{month}}/{{year}}">
                <label>đến ngày</label>
                <input id="id_date2" name="secondDate"
                class="datepicker input-small"
                value="{{day1}}/{{month1}}/{{year1}}">

                <label>
                <input type="radio" name="type1" id='loaitin1' value="1">Tất cả
                </label>

                <label>
                    <input type="radio" name="type1" id='loaitin2' value="2">
                    Đã gửi được
                </label>

                <label>
                    <input type="radio" name="type1" id='loaitin3' value="3">
                    Không gửi được
                </label>

                <input type="submit" value="Xem" class="btn btn-info">
            </fieldset>
        </form>
    </div>

    <table id="sms-table" class="table" width="100%">
        <tr>
            <th>
                STT
            </th>
            <th>
                Người gửi
            </th>
            <th>
                Người nhận
            </th>
            <th>
                Lớp
            </th>
            <th>
            <th>
                SĐT
            </th>
            <th>
                Ngày gửi
            </th>
            <th>
                Nội dung
            </th>
            <th>
                Trạng thái
            </th>
        </tr>
        {% for l in list %}
            <tr>
                <td>
                    {{ forloop.counter }}
                </td>
                <td>
                    {{ teacher_users|get_value:l.sender_id }}
                </td>
                <td>
                    {{ user_to_people|get_value:l.receiver_id|default_if_none:'' }}
                </td>
                <td>
                    {{ user_to_class|get_value:l.receiver_id|default_if_none:'' }}
                </td>
                <td>
                <td>
                    {{ l.phone }}
                </td>
                <td>
                    {{ l.created|date:"SHORT_DATETIME_FORMAT" }}
                </td>
                <td class="truncated" style="max-width:350px;"
                    title="{{ l.content }}">
                    {{ l.content }}
                </td>
                <td>
                    {% if l.recent %}
                        Đang gửi
                    {% else %}
                        {% if l.success %}
                            Thành công
                        {% else %}
                        <a class="click-tooltip"
                            href="#"
                            title="{{l.failed_reason}}">Thất bại</a>
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </table>
{% endblock %}
