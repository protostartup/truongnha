{% extends "teacher/index.html" %}
{% load upload_tags %}
{% load bootstrap %}

{% block breadcrumb %}
    {{ block.super }}
    {% load breadcrumb_tags %}
    {% add_crumb 'Danh sách lớp' %}
{% endblock %}

{% block js %}
    <script type="text/javascript" src="/static/js/teacher/truongnha.table.js?{{ VERSION }}"></script>
    <script type="text/javascript" src="/static/js/teacher/class_view.js?{{ VERSION }}"></script>
{% endblock %}

{% block content %}
    <h2>Danh sách lớp</h2>
    <div id="submenu" class="btn-toolbar">
        <div class="btn-group">
            <a id="btn-diem" title="Nhập hoặc chỉnh sửa điểm các môn học"
               class="btn btn-primary ajaxify" href="{% url class_mark_view user_teacher.id cl.id 'view' %}">
                <i class="icon-star-empty"></i>
                Điểm</a>
        </div>
        <div class="pull-right">
            <div class="btn-group">
                <a id="textSms" class="btn btn-warning"
                   title="Nhắn tin đến những học sinh đã chọn">
                    <i class="icon-envelope"></i>
                    Nhắn tin
                </a>
            </div>
            <div class="btn-group">
                <a id="student-list-menu" class="btn dropdown-toggle"
                   data-toggle="dropdown" herf="#"
                   title="Quản lý danh sách lớp">
                    <span class="icon-reorder"></span>
                </a>
                <ul class="dropdown-menu pull-right">
                    <li>
                        <a id="add-student"
                           class="ajaxify"
                           title="Thêm học sinh mới"
                           href="{% url student_create user_teacher.id cl.id 'create' %}">
                            <i class="icon-plus"></i>
                            Thêm học sinh
                        </a>
                    </li>
                    <li>
                        <a id="delSelected"
                           class="disabled"
                           title="Xóa những học sinh đang được chọn"
                           href="#">
                            <i class="icon-minus"></i>
                            Xóa học sinh
                        </a>
                    </li>
                    <li>
                        <a id="import-student"
                           class=""
                           title="Tải danh sách học sinh từ file Excel"
                           href="#upload_modal"
                           data-toggle="modal">
                            <i class="icon-upload-alt"></i>
                            Nhập từ Excel
                        </a>
                    </li>
                    <li>
                        <a id="export-student"
                           class=""
                           title="Tải danh sách học sinh từ file Excel"
                           href="{% url export_student user_teacher.id cl.id 'export' %}">
                            <i class="icon-download-alt"></i>
                            Xuất ra Excel
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div id="student-table-div">
            <div id="after-post-alert"></div>
            {% if students %}
                <table class="table table-hover student-table fifth-row" id="class-table'">
                    <thead>
                    <tr>
                        <th class="align-left" title="Tài khoản">
                            <i class="icon-user"></i>
                        </th>
                        <th title="Chọn cả lớp" style="text-align: center;">
                            <input type="checkbox" id="checkbox_all" class="studentCheckbox"/>
                        </th>
                        <th style="text-align: center;">STT</th>
                        <th id="thLastName">Họ</th>
                        <th id="thFirstName">Tên</th>
                        <th id="thBirthday">Ngày sinh</th>
                        <th>Giới tính</th>
                        <th title="Điện thoại nhắn tin">Điện thoại</th>
                        <th></th>
                        <th title="Nơi ở hiện tại">Địa chỉ</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for ss in students %}
                        <tr class="selectable"
                            data-id="{{ ss.id }}"
                            style='-webkit-user-select: none; cursor:pointer;'>
                            <td>
                                <i class='icon-key' id='lock-{{ ss.id }}'></i>
                            </td>
                            <td style="text-align: center;">
                                <input type="checkbox" id="checkbox_{{ ss.id }}" class="studentCheckbox"/>
                            </td>
                            <td style="text-align: center;"> {{ forloop.counter }} </td>
                            <td><a class="ajaxify" title="Xem toàn bộ thông tin chi tiết"
                                   href="{% url student_view user_teacher.id cl.id ss.id 'modify' %}">
                                {{ ss.last_name }}</a></td>
                            <td><a class="ajaxify" title="Xem toàn bộ thông tin chi tiết"
                                   href="{% url student_view user_teacher.id cl.id ss.id 'modify' %}">
                                {{ ss.first_name }}</a>
                            </td>
                            <td> {{ ss.birthday|date:"SHORT_DATE_FORMAT" }} </td>
                            <td data-gender="{{ ss.sex }}"> {{ ss.sex }} </td>
                            <td class="smsPhone"> {{ ss.sms_phone }}</td>
                            {% if ss.email %}
                                <td title="{{ ss.email }}">
                                    <i class="icon-envelope"></i>
                                </td>
                            {% else %}
                                <td></td>
                            {% endif %}
                            <td class="truncated" title="{{ ss.current_address }}">
                                {{ ss.current_address }} </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% else %}
                Lớp chưa có học sinh nào.
            {% endif %}
        </div>
    </div>
    <div class="modal fade" id="upload_modal" style="display: none;">
        <div class="modal-header">
            <a class="close" data-dismiss="modal">×</a>

            <h2>Nhập học sinh từ file Excel</h2>
        </div>
        <div class="modal-body">
            <!-- The file upload form used as target for the file upload widget -->
            <form id="fileupload" action="#" method="POST" enctype="multipart/form-data">
                <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
                <div class="fileupload-buttonbar">
                    <div class="span5">
                        <!-- The fileinput-button span is used to style the file input field as button -->
                        <span class="btn btn-success fileinput-button">
                            <i class="icon-plus icon-white"></i>
                            <span>Chọn files...</span>
                            <input type="file" name="files[]" multiple>
                        </span>
                    </div>
                    <div class="span3">
                        <!-- The global progress bar -->
                        <div class="progress progress-success progress-striped active fade">
                            <div class="bar" style="width:0;"></div>
                        </div>
                    </div>
                </div>
                <!-- The loading indicator is shown during image processing -->
                <div class="fileupload-loading"></div>
                <br>
                <!-- The table listing the files available for upload/download -->
                <table class="table table-striped">
                    <tbody class="files" data-toggle="modal-gallery" data-target="#modal-gallery">

                    </tbody>
                </table>
            </form>
            <div id="errorDetail">

            </div>
            <div class="hint">
                <p>
                    Chú ý: Phải dùng file Excel theo <a href="{% url export_student user_teacher.id cl.id 'export' %}">mẫu
                    này</a>.
                </p>

                <p>
                    Nếu bạn gặp trục trặc khi nhập dữ liệu từ file Excel, bạn có thể gửi file cho chúng tôi đến email:
                    support@truongnha.com và chỉ ra tên lớp trong email. Chúng tôi sẽ hỗ trợ nhập file cho bạn.
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <a href="" class="btn" id="upload-modal-exit">Thôi</a>
        </div>
    </div>
    {% upload_js %}
    <script type="text/javascript" src="/static/js/jquery_file_upload/teacher_upload_for_student.js"></script>
    <script type="text/javascript" src="/static/js/jquery_file_upload/locale.js"></script>
{% endblock %}
